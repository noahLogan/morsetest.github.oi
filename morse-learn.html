<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MorseCode</title>
    <link rel="stylesheet" href="assets/css/global.css">
    <style>
        .output {
            font-size: clamp(0.875rem, 0.5625rem + 1vw, 1.125rem);
            margin: 30px auto 0 auto;
            background-color: #fff;
            padding: 5px 15px;
            border-radius: 15px;
        }
        .carousel {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        .carousel button {
            background-color: transparent;
            border: none;
        }
        .letter-display {
            font-size: 3em;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }
        #vibrateButton {
            display: none;
        }
        @media (max-width: 768px) {
            #vibrateButton {
                display: inline-block;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="menu-icon" id="menu-icon" onclick="toggleMenu()">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <a href="index.html" class="MorseCode">MoreMorse</a>
            <ul id="menu" class="hidden">
                <li><a href="index.html" class="menu__option active-item">Aprender</a></li>
                <li><a href="translate.html" class="menu__option">Traducir</a></li>
                <li><a href="game-easy.html" class="menu__option">Jugar</a></li>
            </ul>
        </nav>
    </header>

    <div class="learning-container">
        <h1>Aprende Código Morse</h1>
        <p>Elige entre los botones "Letras" si quieres aprender el abecedario, "Números" si quieres aprender los números. Usa las flechas para seleccionar una letra o número y presiona el botón para escuchar su código Morse.</p>

        <div class="button-learning-container button-learning-container__option">
            <button class="option__button" name="type" value="letters" onclick="switchType('letters')" checked>
                Letras
            </button>
            <button name="type" value="numbers" onclick="switchType('numbers')">
                Números
            </button>
        </div>

        <div class="carousel" aria-label="Carrusel de caracteres en código Morse">
            <button class="arrow-btn" onclick="prevCharacter()" aria-label="Anterior">
                <img src="assets/icons/left.svg" alt="Anterior">
            </button>
            <div class="letter-display" id="character-display">A</div>
            <button class="arrow-btn" onclick="nextCharacter()" aria-label="Siguiente">
                <img src="assets/icons/right.svg" alt="Siguiente">
            </button>
        </div>

        <div class="button-learning-container">
            <button onclick="initializeAudio()">Activar Audio</button>
            <button onclick="playMorseSound()">Reproducir Sonido Código Morse</button>
            <button id="vibrateButton" onclick="activateVibration()">Activar Vibración</button>
            <button onclick="playVibration()">Reproducir Vibración</button>
            <div class="output" id="output" aria-live="polite"></div>
        </div>
    </div>

    <script>
        const morseCode = {
            letters: {
                'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.',
                'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.',
                'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-', 'U': '..-',
                'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..'
            },
            numbers: {
                '0': '-----', '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....',
                '6': '-....', '7': '--...', '8': '---..', '9': '----.'
            }
        };

        let currentType = 'letters';
        let characters = Object.keys(morseCode[currentType]);
        let currentCharacterIndex = 0;
        let vibrationEnabled = false;

        function updateCharacterDisplay() {
            const character = characters[currentCharacterIndex];
            document.getElementById('character-display').textContent = character;
            document.getElementById('output').innerHTML = `<strong>Carácter:</strong> ${character} <br> <strong>Código Morse:</strong> ${morseCode[currentType][character]}`;
        }

        function nextCharacter() {
            currentCharacterIndex = (currentCharacterIndex + 1) % characters.length;
            updateCharacterDisplay();
        }

        function prevCharacter() {
            currentCharacterIndex = (currentCharacterIndex - 1 + characters.length) % characters.length;
            updateCharacterDisplay();
        }

        function switchType(type) {
            currentType = type;
            characters = Object.keys(morseCode[currentType]);
            currentCharacterIndex = 0;
            updateCharacterDisplay();
        }

        function playMorseSound() {
            const character = characters[currentCharacterIndex];
            const morse = morseCode[currentType][character];
            playMorseAudio(morse);
        }

        document.addEventListener("DOMContentLoaded", () => {
            updateCharacterDisplay(); // Inicializa la vista
            if (window.innerWidth <= 768 && 'vibrate' in navigator) {
                document.getElementById('vibrateButton').style.display = 'inline-block';
            }
        });

        function activateVibration() {
            vibrationEnabled = 'vibrate' in navigator;
            if (!vibrationEnabled) {
                alert("La vibración no es compatible en este dispositivo.");
            } else {
                alert("Vibración activada.");
            }
        }

        function playVibration() {
            if (!vibrationEnabled) return;

            const character = characters[currentCharacterIndex];
            const morse = morseCode[currentType][character];
            const vibrationPattern = [];

            morse.split('').forEach(symbol => {
                vibrationPattern.push(symbol === '.' ? 200 : 600);
                vibrationPattern.push(200); // Pausa entre pulsos
            });

            navigator.vibrate(vibrationPattern);
        }

        function getAudioFormat() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/android/i.test(userAgent)) {
                return 'ogg';
            } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                return 'mp3';
            } else {
                return 'ogg';
            }
        }

        let dotSound, dashSound;
        const audioFormat = getAudioFormat();

        function initializeAudio() {
            dotSound = new Audio(`assets/audio/dot-sound.${audioFormat}`);
            dashSound = new Audio(`assets/audio/dash-sound.${audioFormat}`);
            dotSound.load();
            dashSound.load();
            dotSound.play().then(() => {
                dotSound.pause();
                dotSound.currentTime = 0;
            });
            dashSound.play().then(() => {
                dashSound.pause();
                dashSound.currentTime = 0;
            });
            alert("Audio inicializado. Ahora puedes reproducir los sonidos.");
        }

        function playMorseAudio(morse) {
            const dotDuration = 200;
            const dashDuration = 600;
            let delay = 0;

            morse.split('').forEach(symbol => {
                setTimeout(() => {
                    const sound = symbol === '.' ? dotSound : dashSound;
                    sound.currentTime = 0;
                    sound.play().catch(error => console.error(`Error al reproducir sonido:`, error));
                }, delay);
                delay += (symbol === '.' ? dotDuration : dashDuration) + 200;
            });
        }
    </script>

    <script src="assets/js/translate.js"></script>
    <script src="assets/js/menu.js"></script>
</body>
</html>
